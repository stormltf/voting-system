-- 导入三期1号楼投票记录
-- 投票轮次: 1=2023, 2=2024, 3=2025A, 4=2025B
-- 投票状态: voted=已投, refused=拒绝, pending=未投, onsite=现场投票, video=视频投票

USE voting_system;

-- 根据原始数据导入投票记录
-- 25B投否列: 微信表决/弃权/现场表决/视频表决/无法联系/拒绝/待处理等
-- 25A投否列: 同上
-- 2024投否: 投了/未投/无法联系等
-- 2023投否: 投了/未投等

-- 2025B轮次 (round_id = 4)
INSERT INTO votes (owner_id, round_id, vote_status, remark)
SELECT o.id, 4,
  CASE
    WHEN '微信表决' IN ('微信表决') THEN 'voted'
    WHEN '现场表决' IN ('现场表决') THEN 'onsite'
    WHEN '视频表决' IN ('视频表决') THEN 'video'
    WHEN '弃权' IN ('弃权') THEN 'voted'
    WHEN '拒绝' IN ('拒绝') THEN 'refused'
    ELSE 'pending'
  END,
  NULL
FROM owners o WHERE o.phase_id = 2 AND o.id = 0;  -- 占位，下面手动插入

-- 清空可能存在的旧投票记录
DELETE FROM votes WHERE owner_id IN (SELECT id FROM owners WHERE phase_id = 2);

-- 插入2025B轮次投票记录 (round_id = 4)
INSERT INTO votes (owner_id, round_id, vote_status, remark) VALUES
-- 01-01单元
(1, 4, 'voted', '微信表决'),
(2, 4, 'voted', '微信表决'),
(3, 4, 'voted', '微信表决'),
(4, 4, 'voted', '微信表决'),
(5, 4, 'pending', '无法联系'),
(6, 4, 'voted', '微信表决'),
(7, 4, 'voted', '微信表决'),
(8, 4, 'voted', '微信表决'),
(9, 4, 'voted', '微信表决'),
(10, 4, 'voted', '微信表决'),
(11, 4, 'pending', '无法联系'),
(12, 4, 'pending', '无法联系'),
(13, 4, 'pending', '待处理'),
(14, 4, 'voted', '微信表决'),
(15, 4, 'voted', '微信表决'),
(16, 4, 'voted', '微信表决'),
(17, 4, 'voted', '微信表决'),
(18, 4, 'voted', '微信表决'),
(19, 4, 'voted', '微信表决'),
(20, 4, 'voted', '微信表决'),
(21, 4, 'voted', '微信表决'),
(22, 4, 'voted', '微信表决'),
(23, 4, 'voted', '微信表决'),
(24, 4, 'voted', '微信表决'),
(25, 4, 'pending', '无法联系'),
(26, 4, 'voted', '微信表决'),
(27, 4, 'pending', '无法联系'),
(28, 4, 'voted', '微信表决'),
(29, 4, 'pending', '待处理'),
(30, 4, 'voted', '微信表决'),
(31, 4, 'voted', '微信表决'),
(32, 4, 'voted', '微信表决'),
(33, 4, 'voted', '微信表决'),
(34, 4, 'voted', '微信表决'),
(35, 4, 'voted', '微信表决'),
(36, 4, 'voted', '微信表决'),
(37, 4, 'voted', '微信表决'),
(38, 4, 'voted', '微信表决'),
(39, 4, 'voted', '微信表决'),
(40, 4, 'voted', '微信表决'),
(41, 4, 'voted', '微信表决'),
(42, 4, 'voted', '微信表决'),
(43, 4, 'voted', '微信表决'),
(44, 4, 'pending', '无法联系'),
(45, 4, 'pending', '待处理'),
(46, 4, 'voted', '微信表决'),
(47, 4, 'voted', '微信表决'),
(48, 4, 'pending', '无法联系'),
(49, 4, 'voted', '微信表决'),
(50, 4, 'pending', '无法联系'),
(51, 4, 'voted', '微信表决'),
(52, 4, 'pending', '待处理'),
(53, 4, 'voted', '微信表决'),
(54, 4, 'pending', '待处理'),
-- 01-02单元
(55, 4, 'voted', '微信表决'),
(56, 4, 'voted', '微信表决'),
(57, 4, 'voted', '微信表决'),
(58, 4, 'voted', '微信表决'),
(59, 4, 'voted', '微信表决'),
(60, 4, 'voted', '微信表决'),
(61, 4, 'voted', '微信表决'),
(62, 4, 'voted', '微信表决'),
(63, 4, 'voted', '微信表决'),
(64, 4, 'voted', '微信表决'),
(65, 4, 'voted', '微信表决'),
(66, 4, 'voted', '微信表决'),
(67, 4, 'voted', '微信表决'),
(68, 4, 'voted', '微信表决'),
(69, 4, 'voted', '微信表决'),
(70, 4, 'voted', '微信表决'),
(71, 4, 'voted', '微信表决'),
(72, 4, 'voted', '微信表决'),
(73, 4, 'pending', '无法联系'),
(74, 4, 'pending', '无法联系'),
(75, 4, 'voted', '微信表决'),
(76, 4, 'pending', '无法联系'),
(77, 4, 'onsite', '现场表决'),
(78, 4, 'voted', '微信表决'),
(79, 4, 'pending', '无法联系'),
(80, 4, 'pending', '无法联系'),
(81, 4, 'voted', '微信表决'),
(82, 4, 'pending', '无法联系'),
(83, 4, 'voted', '微信表决'),
(84, 4, 'voted', '微信表决'),
(85, 4, 'pending', '无法联系'),
(86, 4, 'pending', '无法联系'),
(87, 4, 'voted', '微信表决'),
(88, 4, 'voted', '微信表决'),
(89, 4, 'voted', '微信表决'),
(90, 4, 'voted', '微信表决'),
(91, 4, 'voted', '微信表决'),
(92, 4, 'pending', '无法联系'),
(93, 4, 'pending', '无法联系'),
(94, 4, 'voted', '微信表决'),
(95, 4, 'voted', '微信表决'),
(96, 4, 'voted', '微信表决'),
(97, 4, 'voted', '微信表决'),
(98, 4, 'voted', '微信表决'),
(99, 4, 'pending', '无法联系'),
(100, 4, 'voted', '微信表决'),
(101, 4, 'voted', '微信表决'),
(102, 4, 'voted', '微信表决'),
(103, 4, 'voted', '微信表决'),
(104, 4, 'voted', '微信表决'),
(105, 4, 'pending', '无法联系'),
(106, 4, 'voted', '微信表决'),
(107, 4, 'pending', '待处理'),
(108, 4, 'voted', '微信表决');

-- 插入2025A轮次投票记录 (round_id = 3)
INSERT INTO votes (owner_id, round_id, vote_status, remark) VALUES
(1, 3, 'voted', '微信表决'),
(2, 3, 'voted', '微信表决'),
(3, 3, 'voted', '微信表决'),
(4, 3, 'voted', '微信表决'),
(5, 3, 'pending', '无法联系'),
(6, 3, 'voted', '微信表决'),
(7, 3, 'voted', '微信表决'),
(8, 3, 'voted', '微信表决'),
(9, 3, 'voted', '微信表决'),
(10, 3, 'voted', '微信表决'),
(11, 3, 'pending', '无法联系'),
(12, 3, 'pending', '无法联系'),
(13, 3, 'pending', '待处理'),
(14, 3, 'voted', '微信表决'),
(15, 3, 'voted', '微信表决'),
(16, 3, 'voted', '微信表决'),
(17, 3, 'voted', '微信表决'),
(18, 3, 'voted', '微信表决'),
(19, 3, 'voted', '微信表决'),
(20, 3, 'voted', '微信表决'),
(21, 3, 'voted', '微信表决'),
(22, 3, 'voted', '微信表决'),
(23, 3, 'voted', '微信表决'),
(24, 3, 'voted', '微信表决'),
(25, 3, 'pending', '无法联系'),
(26, 3, 'voted', '微信表决'),
(27, 3, 'pending', '无法联系'),
(28, 3, 'voted', '微信表决'),
(29, 3, 'pending', '待处理'),
(30, 3, 'voted', '微信表决'),
(31, 3, 'voted', '微信表决'),
(32, 3, 'voted', '微信表决'),
(33, 3, 'voted', '微信表决'),
(34, 3, 'voted', '微信表决'),
(35, 3, 'voted', '微信表决'),
(36, 3, 'voted', '微信表决'),
(37, 3, 'voted', '微信表决'),
(38, 3, 'voted', '微信表决'),
(39, 3, 'voted', '微信表决'),
(40, 3, 'voted', '微信表决'),
(41, 3, 'voted', '微信表决'),
(42, 3, 'voted', '微信表决'),
(43, 3, 'voted', '微信表决'),
(44, 3, 'pending', '无法联系'),
(45, 3, 'pending', '待处理'),
(46, 3, 'voted', '微信表决'),
(47, 3, 'voted', '微信表决'),
(48, 3, 'pending', '无法联系'),
(49, 3, 'voted', '微信表决'),
(50, 3, 'pending', '无法联系'),
(51, 3, 'voted', '微信表决'),
(52, 3, 'pending', '待处理'),
(53, 3, 'voted', '微信表决'),
(54, 3, 'pending', '待处理'),
(55, 3, 'voted', '微信表决'),
(56, 3, 'voted', '微信表决'),
(57, 3, 'voted', '微信表决'),
(58, 3, 'voted', '微信表决'),
(59, 3, 'voted', '微信表决'),
(60, 3, 'voted', '微信表决'),
(61, 3, 'voted', '微信表决'),
(62, 3, 'voted', '微信表决'),
(63, 3, 'voted', '微信表决'),
(64, 3, 'voted', '微信表决'),
(65, 3, 'voted', '微信表决'),
(66, 3, 'voted', '微信表决'),
(67, 3, 'voted', '微信表决'),
(68, 3, 'voted', '微信表决'),
(69, 3, 'voted', '微信表决'),
(70, 3, 'voted', '微信表决'),
(71, 3, 'voted', '微信表决'),
(72, 3, 'voted', '微信表决'),
(73, 3, 'pending', '无法联系'),
(74, 3, 'pending', '无法联系'),
(75, 3, 'voted', '微信表决'),
(76, 3, 'pending', '无法联系'),
(77, 3, 'onsite', '现场表决'),
(78, 3, 'voted', '微信表决'),
(79, 3, 'pending', '无法联系'),
(80, 3, 'pending', '无法联系'),
(81, 3, 'voted', '微信表决'),
(82, 3, 'pending', '无法联系'),
(83, 3, 'voted', '微信表决'),
(84, 3, 'voted', '微信表决'),
(85, 3, 'pending', '无法联系'),
(86, 3, 'pending', '无法联系'),
(87, 3, 'voted', '微信表决'),
(88, 3, 'voted', '微信表决'),
(89, 3, 'voted', '微信表决'),
(90, 3, 'voted', '微信表决'),
(91, 3, 'voted', '微信表决'),
(92, 3, 'pending', '无法联系'),
(93, 3, 'pending', '无法联系'),
(94, 3, 'voted', '微信表决'),
(95, 3, 'voted', '微信表决'),
(96, 3, 'voted', '微信表决'),
(97, 3, 'voted', '微信表决'),
(98, 3, 'voted', '微信表决'),
(99, 3, 'pending', '无法联系'),
(100, 3, 'voted', '微信表决'),
(101, 3, 'voted', '微信表决'),
(102, 3, 'voted', '微信表决'),
(103, 3, 'voted', '微信表决'),
(104, 3, 'voted', '微信表决'),
(105, 3, 'pending', '无法联系'),
(106, 3, 'voted', '微信表决'),
(107, 3, 'pending', '待处理'),
(108, 3, 'voted', '微信表决');

-- 插入2024轮次投票记录 (round_id = 2)
INSERT INTO votes (owner_id, round_id, vote_status, remark) VALUES
(1, 2, 'voted', NULL),
(2, 2, 'voted', NULL),
(3, 2, 'voted', NULL),
(4, 2, 'voted', NULL),
(5, 2, 'pending', '无法联系'),
(6, 2, 'voted', NULL),
(7, 2, 'voted', NULL),
(8, 2, 'voted', NULL),
(9, 2, 'voted', NULL),
(10, 2, 'voted', NULL),
(11, 2, 'pending', '无法联系'),
(12, 2, 'pending', '无法联系'),
(13, 2, 'pending', '无法联系'),
(14, 2, 'voted', NULL),
(15, 2, 'voted', NULL),
(16, 2, 'voted', NULL),
(17, 2, 'voted', NULL),
(18, 2, 'voted', NULL),
(19, 2, 'voted', NULL),
(20, 2, 'voted', NULL),
(21, 2, 'voted', NULL),
(22, 2, 'voted', NULL),
(23, 2, 'voted', NULL),
(24, 2, 'voted', NULL),
(25, 2, 'pending', '无法联系'),
(26, 2, 'voted', NULL),
(27, 2, 'pending', '无法联系'),
(28, 2, 'voted', NULL),
(29, 2, 'pending', NULL),
(30, 2, 'voted', NULL),
(31, 2, 'voted', NULL),
(32, 2, 'voted', NULL),
(33, 2, 'voted', NULL),
(34, 2, 'voted', NULL),
(35, 2, 'voted', NULL),
(36, 2, 'voted', NULL),
(37, 2, 'voted', NULL),
(38, 2, 'voted', NULL),
(39, 2, 'voted', NULL),
(40, 2, 'voted', NULL),
(41, 2, 'voted', NULL),
(42, 2, 'voted', NULL),
(43, 2, 'voted', NULL),
(44, 2, 'pending', '无法联系'),
(45, 2, 'pending', NULL),
(46, 2, 'voted', NULL),
(47, 2, 'voted', NULL),
(48, 2, 'pending', '无法联系'),
(49, 2, 'voted', NULL),
(50, 2, 'pending', '无法联系'),
(51, 2, 'voted', NULL),
(52, 2, 'pending', NULL),
(53, 2, 'voted', NULL),
(54, 2, 'pending', NULL),
(55, 2, 'voted', NULL),
(56, 2, 'voted', NULL),
(57, 2, 'voted', NULL),
(58, 2, 'voted', NULL),
(59, 2, 'voted', NULL),
(60, 2, 'voted', NULL),
(61, 2, 'voted', NULL),
(62, 2, 'voted', NULL),
(63, 2, 'voted', NULL),
(64, 2, 'voted', NULL),
(65, 2, 'voted', NULL),
(66, 2, 'voted', NULL),
(67, 2, 'voted', NULL),
(68, 2, 'voted', NULL),
(69, 2, 'voted', NULL),
(70, 2, 'voted', NULL),
(71, 2, 'voted', NULL),
(72, 2, 'voted', NULL),
(73, 2, 'pending', '无法联系'),
(74, 2, 'pending', NULL),
(75, 2, 'voted', NULL),
(76, 2, 'pending', '无法联系'),
(77, 2, 'voted', NULL),
(78, 2, 'voted', NULL),
(79, 2, 'pending', '无法联系'),
(80, 2, 'pending', '无法联系'),
(81, 2, 'voted', NULL),
(82, 2, 'pending', '无法联系'),
(83, 2, 'voted', NULL),
(84, 2, 'voted', NULL),
(85, 2, 'pending', '无法联系'),
(86, 2, 'pending', '无法联系'),
(87, 2, 'voted', NULL),
(88, 2, 'voted', NULL),
(89, 2, 'voted', NULL),
(90, 2, 'voted', NULL),
(91, 2, 'voted', NULL),
(92, 2, 'pending', '无法联系'),
(93, 2, 'pending', '无法联系'),
(94, 2, 'voted', NULL),
(95, 2, 'voted', NULL),
(96, 2, 'voted', NULL),
(97, 2, 'voted', NULL),
(98, 2, 'voted', NULL),
(99, 2, 'pending', '无法联系'),
(100, 2, 'voted', NULL),
(101, 2, 'voted', NULL),
(102, 2, 'voted', NULL),
(103, 2, 'voted', NULL),
(104, 2, 'voted', NULL),
(105, 2, 'pending', '无法联系'),
(106, 2, 'voted', NULL),
(107, 2, 'pending', NULL),
(108, 2, 'voted', NULL);

-- 插入2023轮次投票记录 (round_id = 1)
INSERT INTO votes (owner_id, round_id, vote_status, remark) VALUES
(1, 1, 'voted', NULL),
(2, 1, 'voted', NULL),
(3, 1, 'voted', NULL),
(4, 1, 'voted', NULL),
(5, 1, 'pending', NULL),
(6, 1, 'voted', NULL),
(7, 1, 'voted', NULL),
(8, 1, 'voted', NULL),
(9, 1, 'voted', NULL),
(10, 1, 'voted', NULL),
(11, 1, 'pending', NULL),
(12, 1, 'pending', NULL),
(13, 1, 'pending', NULL),
(14, 1, 'voted', NULL),
(15, 1, 'voted', NULL),
(16, 1, 'voted', NULL),
(17, 1, 'voted', NULL),
(18, 1, 'voted', NULL),
(19, 1, 'voted', NULL),
(20, 1, 'voted', NULL),
(21, 1, 'voted', NULL),
(22, 1, 'voted', NULL),
(23, 1, 'voted', NULL),
(24, 1, 'voted', NULL),
(25, 1, 'pending', NULL),
(26, 1, 'voted', NULL),
(27, 1, 'pending', NULL),
(28, 1, 'voted', NULL),
(29, 1, 'pending', NULL),
(30, 1, 'voted', NULL),
(31, 1, 'voted', NULL),
(32, 1, 'voted', NULL),
(33, 1, 'voted', NULL),
(34, 1, 'voted', NULL),
(35, 1, 'voted', NULL),
(36, 1, 'voted', NULL),
(37, 1, 'voted', NULL),
(38, 1, 'voted', NULL),
(39, 1, 'voted', NULL),
(40, 1, 'voted', NULL),
(41, 1, 'voted', NULL),
(42, 1, 'voted', NULL),
(43, 1, 'voted', NULL),
(44, 1, 'pending', NULL),
(45, 1, 'pending', NULL),
(46, 1, 'voted', NULL),
(47, 1, 'voted', NULL),
(48, 1, 'pending', NULL),
(49, 1, 'voted', NULL),
(50, 1, 'pending', NULL),
(51, 1, 'voted', NULL),
(52, 1, 'pending', NULL),
(53, 1, 'voted', NULL),
(54, 1, 'pending', NULL),
(55, 1, 'voted', NULL),
(56, 1, 'voted', NULL),
(57, 1, 'voted', NULL),
(58, 1, 'voted', NULL),
(59, 1, 'voted', NULL),
(60, 1, 'voted', NULL),
(61, 1, 'voted', NULL),
(62, 1, 'voted', NULL),
(63, 1, 'voted', NULL),
(64, 1, 'voted', NULL),
(65, 1, 'voted', NULL),
(66, 1, 'voted', NULL),
(67, 1, 'voted', NULL),
(68, 1, 'voted', NULL),
(69, 1, 'voted', NULL),
(70, 1, 'voted', NULL),
(71, 1, 'voted', NULL),
(72, 1, 'voted', NULL),
(73, 1, 'pending', NULL),
(74, 1, 'pending', NULL),
(75, 1, 'voted', NULL),
(76, 1, 'pending', NULL),
(77, 1, 'voted', NULL),
(78, 1, 'voted', NULL),
(79, 1, 'pending', NULL),
(80, 1, 'pending', NULL),
(81, 1, 'voted', NULL),
(82, 1, 'pending', NULL),
(83, 1, 'voted', NULL),
(84, 1, 'voted', NULL),
(85, 1, 'pending', NULL),
(86, 1, 'pending', NULL),
(87, 1, 'voted', NULL),
(88, 1, 'voted', NULL),
(89, 1, 'voted', NULL),
(90, 1, 'voted', NULL),
(91, 1, 'voted', NULL),
(92, 1, 'pending', NULL),
(93, 1, 'pending', NULL),
(94, 1, 'voted', NULL),
(95, 1, 'voted', NULL),
(96, 1, 'voted', NULL),
(97, 1, 'voted', NULL),
(98, 1, 'voted', NULL),
(99, 1, 'pending', NULL),
(100, 1, 'voted', NULL),
(101, 1, 'voted', NULL),
(102, 1, 'voted', NULL),
(103, 1, 'voted', NULL),
(104, 1, 'voted', NULL),
(105, 1, 'pending', NULL),
(106, 1, 'voted', NULL),
(107, 1, 'pending', NULL),
(108, 1, 'voted', NULL);

-- 统计结果
SELECT
  vr.name AS round_name,
  COUNT(*) AS total,
  SUM(CASE WHEN v.vote_status IN ('voted', 'onsite', 'video') THEN 1 ELSE 0 END) AS voted,
  SUM(CASE WHEN v.vote_status = 'pending' THEN 1 ELSE 0 END) AS pending,
  SUM(CASE WHEN v.vote_status = 'refused' THEN 1 ELSE 0 END) AS refused
FROM votes v
JOIN vote_rounds vr ON v.round_id = vr.id
GROUP BY vr.id, vr.name
ORDER BY vr.id;
